<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Assignments Hub - Test</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f2f6fb; color:#111; }
header{background:#1f2937;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;}
header a{color:#fff;text-decoration:none}
.container{max-width:600px;margin:20px auto;padding:12px}
form{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:18px}
input, textarea{width:100%;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:8px;font-size:14px}
button{padding:8px 12px;border-radius:8px;border:none;background:#0ea5a4;color:#fff;cursor:pointer}
.post{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-bottom:12px}
.post-meta{font-weight:700;color:#333}
.post-desc{margin-top:8px;color:#222}
</style>
</head>
<body>

<header>
<div>üìò Assignments Hub - Test</div>
<div><a href="#">üè† Home</a></div>
</header>

<div class="container">
<form id="postForm">
  <input id="posterName" placeholder="Your name" required/>
  <input id="title" placeholder="Title" required/>
  <textarea id="description" rows="4" placeholder="Assignment details" required></textarea>
  <button type="submit">Post</button>
  <div id="postMsg" style="color:red;margin-top:8px"></div>
</form>

<div id="feedList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfOuOzk9-XqcjBwU2mNvazOgr-lfcEYYk",
  authDomain: "cscassignmentdb.firebaseapp.com",
  projectId: "cscassignmentdb",
  storageBucket: "cscassignmentdb.appspot.com",
  messagingSenderId: "386977717971",
  appId: "1:386977717971:web:74b4b47cb343711ce5fe26"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const postForm = document.getElementById("postForm");
const feedList = document.getElementById("feedList");
const postMsg = document.getElementById("postMsg");

function escapeHtml(str){return String(str||"").replace(/[&<>"']/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));}

postForm.addEventListener("submit", async e => {
  e.preventDefault();
  postMsg.textContent="";
  const posterName = document.getElementById("posterName").value.trim();
  const title = document.getElementById("title").value.trim();
  const description = document.getElementById("description").value.trim();
  if(!posterName||!title||!description){postMsg.textContent="Please fill all fields"; return;}
  try{
    await addDoc(collection(db,"posts"), {
      posterName,
      title,
      description,
      create_at: serverTimestamp()
    });
    postForm.reset();
  } catch(err) {
    console.error(err);
    postMsg.textContent="Failed to post";
  }
});

// Real-time feed
onSnapshot(collection(db,"posts"), snapshot=>{
  const posts = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
  // sort by timestamp descending
  posts.sort((a,b)=>(b.create_at?.seconds||0)-(a.create_at?.seconds||0));
  feedList.innerHTML = "";
  posts.forEach(post=>{
    const div = document.createElement("div");
    div.className="post";
    const time = post.create_at ? new Date(post.create_at.seconds*1000).toLocaleString() : "";
    div.innerHTML = `<div class="post-meta">${escapeHtml(post.posterName)} ‚Äî ${escapeHtml(post.title)} ‚Ä¢ <small>${time}</small></div>
                     <div class="post-desc">${escapeHtml(post.description)}</div>`;
    feedList.appendChild(div);
  });
});
</script>
</body>
</html>